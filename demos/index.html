<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>DLP Demo (XGBoost)</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f3f3f3; }
    .ALLOW{color:#2e7d32;font-weight:600}
    .WARN{color:#b26a00;font-weight:600}
    .BLOCK{color:#c62828;font-weight:700}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
  </style>
</head>
<body>
  <h2>AI DLP â€” Upload & Scan</h2>
  <p>Upload a CSV with a <code>text</code> column.</p>
  <input type="file" id="file" accept=".csv"/>
  <button id="btn">Upload & Scan</button>
  <div id="summary"></div>
  <table id="tbl" style="display:none">
    <thead><tr><th>#</th><th>text</th><th>class</th><th>score</th><th>policy</th><th>phones</th></tr></thead>
    <tbody></tbody>
  </table>

  <hr/>
  <h3>Try single message</h3>
  <textarea id="single" rows="3" style="width:100%" placeholder="Type text here..."></textarea>
  <button id="check">Analyze</button>
  <pre id="singleOut" class="mono"></pre>

<script>
const API = "http://localhost:8000";

document.getElementById("btn").onclick = async () => {
  const f = document.getElementById("file").files[0];
  if(!f){ alert("Pick a CSV first"); return; }
  const fd = new FormData(); fd.append("file", f);
  const res = await fetch(API + "/upload-csv", { method: "POST", body: fd });
  const data = await res.json();
  if(data.error){ alert(data.error); return; }

  document.getElementById("summary").textContent =
    "Rows: " + data.rows + " | Policies: " + JSON.stringify(data.summary);

  const tbl = document.getElementById("tbl");
  const tb  = tbl.querySelector("tbody");
  tb.innerHTML = "";
  (data.preview || []).forEach((row, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td>
      <td>${(row.text||"").toString().slice(0,140)}</td>
      <td>${row.class}</td>
      <td>${row.score}</td>
      <td class="${row.policy}">${row.policy}</td>
      <td>${row.phones||""}</td>`;
    tb.appendChild(tr);
  });
  tbl.style.display = "table";
};

document.getElementById("check").onclick = async () => {
  const text = document.getElementById("single").value;
  const res = await fetch(API + "/analyze-text", {
    method: "POST", headers: {"Content-Type": "application/json"},
    body: JSON.stringify({text})
  });
  document.getElementById("singleOut").textContent =
    JSON.stringify(await res.json(), null, 2);
};
</script>
</body>
</html>
